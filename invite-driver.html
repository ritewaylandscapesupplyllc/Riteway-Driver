<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Invite Driver | Riteway Dispatch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    :root {
      --bg: #050608;
      --bg-elevated: #15191f;
      --bg-elevated-soft: #1b2129;
      --accent: #1A8F7A;
      --accent-soft: rgba(26,143,122,0.18);
      --accent-strong: #12C3A0;
      --text: #f5f7fb;
      --text-muted: #a6afb8;
      --border-subtle: #252c35;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.55);
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #151a20 0, #050608 55%, #020203 100%);
      color: var(--text);
      padding: 18px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("riteway-logo-watermark.png");
      background-repeat: no-repeat;
      background-position: center;
      background-size: min(80vw, 520px);
      opacity: 0.05;
      pointer-events: none;
      z-index: 0;
      filter: drop-shadow(0 0 30px rgba(0,0,0,0.7));
    }

    .app-shell {
      width: 100%;
      max-width: 480px;
      position: relative;
      z-index: 1;
    }

    .logo-wrapper {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 20px;
      margin-bottom: -30px;
      position: relative;
      z-index: 5;
    }

    .brand-logo {
      width: 220px;
      height: auto;
      display: block;
      filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.7));
    }

    .card {
      background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.78));
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(16px);
      padding: 26px 18px 18px;
      margin-top: 12px;
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .title-main {
      font-size: 1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent-strong);
    }

    .title-sub {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .badge {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--accent-soft);
      background: rgba(5, 8, 11, 0.85);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .field-group {
      margin-top: 12px;
    }

    label {
      display: block;
      font-size: 0.78rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 4px;
      text-align: left;
    }

    .field {
      background: rgba(10, 13, 18, 0.9);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 8px 10px 4px;
      transition: border 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    }

    .field:focus-within {
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(18,195,160,0.35);
      background: rgba(12,16,22,0.96);
    }

    input[type="text"],
    input[type="email"] {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
      font-size: 0.95rem;
      padding: 4px 0 8px;
    }

    input::placeholder {
      color: rgba(166,175,184,0.7);
    }

    .hint {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .actions {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      border: none;
      border-radius: var(--radius-pill);
      padding: 11px 0;
      font-size: 0.96rem;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #031210;
      box-shadow: 0 12px 26px rgba(18,195,160,0.45);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.7);
    }

    .btn-ghost {
      background: rgba(9,12,17,0.9);
      color: var(--text-muted);
      border: 1px solid var(--border-subtle);
    }

    .status-box {
      margin-top: 16px;
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--bg-elevated-soft);
      border: 1px solid rgba(26,143,122,0.25);
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .status-box strong {
      color: var(--accent-strong);
    }

    #log {
      margin-top: 10px;
      padding: 8px 10px;
      background: rgba(5,8,11,0.98);
      border-radius: 10px;
      border: 1px dashed var(--border-subtle);
      font-family: "JetBrains Mono", monospace;
      font-size: 0.7rem;
      line-height: 1.4;
      max-height: 150px;
      overflow-y: auto;
      color: var(--text-muted);
    }

    a.back-link {
      display: inline-block;
      margin-top: 14px;
      font-size: 0.8rem;
      color: var(--accent-strong);
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="logo-wrapper">
      <img src="riteway-logo.png" alt="Riteway Logo" class="brand-logo">
    </div>

    <div class="card">
      <div class="header-row">
        <div>
          <div class="title-main">Invite New Driver</div>
          <div class="title-sub">Send a branded email link to join the Riteway Driver app.</div>
        </div>
        <div class="badge">Dispatch Tool</div>
      </div>

      <div class="field-group">
        <label for="driverName">Driver Name</label>
        <div class="field">
          <input type="text" id="driverName" placeholder="E.g. Blaine Fowles">
        </div>
      </div>

      <div class="field-group">
        <label for="driverEmail">Driver Email</label>
        <div class="field">
          <input type="email" id="driverEmail" placeholder="driver@example.com">
        </div>
      </div>

      <p class="hint">
        When you tap <strong>Send invite</strong>, Firebase will email the driver a secure sign-in link using your
        branded template. We also log the invite in the database under <code>/driverInvites</code>.
      </p>

      <div class="actions">
        <button class="btn-primary" onclick="sendInvite()">Send invite</button>
        <button class="btn-ghost" onclick="clearForm()">Clear</button>
      </div>

      <div class="status-box" id="statusBox">
        <strong>Status:</strong> Ready to invite a driver.
      </div>

      <div id="log"><strong>Log</strong></div>

      <a href="dispatch.html" class="back-link">← Back to dispatch dashboard</a>
    </div>
  </div>

  <script>
    // --- Firebase config (same project as your driver + customer apps) ---
    const firebaseConfig = {
      apiKey: "AIzaSyDmyq_bxVHipY5UxZY-28sXUu0-fJvL69I",
      authDomain: "ritewaytracking-3e9d0.firebaseapp.com",
      databaseURL: "https://ritewaytracking-3e9d0-default-rtdb.firebaseio.com",
      projectId: "ritewaytracking-3e9d0",
      storageBucket: "ritewaytracking-3e9d0.firebasestorage.app",
      messagingSenderId: "817275576166",
      appId: "1:817275576166:web:56a92bcaf8f60d52a0b2a7"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // This is where the email-link will send the driver after they tap it.
    // We'll build this driver-login page later; for now we just wire the link.
    const actionCodeSettings = {
      url: "https://ritewaylandscapesupplyllc.github.io/Riteway-Driver/driver-login.html",
      handleCodeInApp: true
    };

    function setStatus(msg) {
      document.getElementById("statusBox").innerHTML =
        "<strong>Status:</strong> " + msg;
    }

    function log(msg) {
      const logBox = document.getElementById("log");
      const time = new Date().toLocaleTimeString();
      logBox.innerHTML += "<br>[" + time + "] " + msg;
      logBox.scrollTop = logBox.scrollHeight;
      console.log(msg);
    }

    function clearForm() {
      document.getElementById("driverName").value = "";
      document.getElementById("driverEmail").value = "";
      setStatus("Ready to invite a driver.");
    }

    function sendInvite() {
      const name = document.getElementById("driverName").value.trim();
      const email = document.getElementById("driverEmail").value.trim().toLowerCase();

      if (!email) {
        alert("Please enter the driver's email.");
        return;
      }

      setStatus("Sending invite…");
      log("Sending email-link invite to " + email);

      // Remember the email locally so the driver-login page can prefill it if it's opened on this device.
      try {
        window.localStorage.setItem("ritewayInviteEmail", email);
      } catch (e) {
        console.warn("Unable to access localStorage:", e);
      }

      auth.sendSignInLinkToEmail(email, actionCodeSettings)
        .then(() => {
          setStatus("Invite sent to " + email);
          log("Firebase Auth email-link sent.");

          // Log invite in database for your records
          const inviteRef = db.ref("driverInvites").push();
          inviteRef.set({
            name: name || "",
            email: email,
            sentAt: new Date().toISOString()
          }).then(() => {
            log("Invite saved under /driverInvites/" + inviteRef.key);
          }).catch(err => {
            log("ERROR saving invite: " + err.message);
          });
        })
        .catch(error => {
          console.error(error);
          setStatus("Error sending invite: " + error.message);
          log("ERROR sending invite: " + error.message);
          alert("Error sending invite:\n" + error.message);
        });
    }
  </script>
</body>
</html>
